var port = 8000;
var http = require("http");
// var slimerjs = require('node-slimerjs');
var slimerjs = require('node-phantom-simple');

var server = http.createServer();
server.on('request', request);
server.listen(port);

var http = require('http'),
    fs = require('fs'),
    // NEVER use a Sync function except at start-up!
    index = fs.readFileSync(__dirname + '/index.html');

// Send index.html to all requests
var app = http.createServer(function(req, res) {
    res.writeHead(200, {'Content-Type': 'text/html'});
    res.end(index);
});

// Socket.io server listens to our app
var io = require('socket.io').listen(app);

// Send current time to all connected clients
function sendTime() {
    io.emit('time', { time: new Date().toJSON() });
}

// Send current time every 10 secs
setInterval(sendTime, 1);

// Emit welcome message on connection
io.on('connection', function(socket) {
    // Use socket to communicate with this particular client only, sending it it's own id
    socket.emit('welcome', { time: new Date().toJSON(),message: 'Welcome!', id: socket.id });

    socket.on('i am client', console.log);
});

app.listen(3000);

function request(request, response) {
    var store = '';

    request.on('data', function(data) 
    {
        store += data;
    });
    request.on('end', function() 
    {  console.log(store);
       response.setHeader("Content-Type", "text/json");
       response.setHeader("Access-Control-Allow-Origin", "*");
       response.end(store);
    });
 }  

slimerjs.create({ path: require('slimerjs').path
		}
		,function(err,sl){
		    
		    // sl.get('version',function(err,v){
		    // 	console.log("%%%",v)
		    // })
		    return sl.createPage(function(err,page) {
		
	return page.open("http://dev.fev1", function(err,status) {
	    page.onResourceReceived=function(response){
		// console.log(response.contentType)
		 if(response.contentType==='text/html')
		    console.log(response.contentType,response.body)
	    };
	    
	    page.set('viewportSize',{width: 1200,height: 750});
	    var re = new RegExp("/html/");
	    var re2 = new RegExp("/text/");
	    
	    // page.set('captureContent',[re,re2])
	    //console.log(page.property('captureContent'))
	    
	   
	    // page.get('captureContent', function(err,val,t){
		
	    // 	console.log('1) ',val)
	    	
	    	
		
	    // });

	    // var a=sl.captureContent('hi',function(){})
	    // console.log(a)
	    
	    
	    
	});
    });
}
	       );




